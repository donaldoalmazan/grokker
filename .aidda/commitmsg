move the header extraction logic to a separate function
